{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import API from'../services/api';// Import our API service\nimport{Box,Card,CardContent,TextField,Button,Typography,Alert,CircularProgress}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){const[identifier,setIdentifier]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleLogin=async e=>{e.preventDefault();setLoading(true);setError('');try{var _userResponse$data$st;// Use API service instead of axios directly\nconst loginResponse=await API.post('/api/auth/local',{identifier,password});const jwt=loginResponse.data.jwt;if(!jwt){throw new Error('No JWT received');}localStorage.setItem('jwtToken',jwt);// Use API service for user data\nconst userResponse=await API.get('/api/users/me?populate=store');console.log('User data:',userResponse.data);if(!((_userResponse$data$st=userResponse.data.store)!==null&&_userResponse$data$st!==void 0&&_userResponse$data$st.id)){throw new Error('User has no assigned store');}// Save store ID and user ID\nlocalStorage.setItem('storeId',userResponse.data.store.id);localStorage.setItem('userId',userResponse.data.id);console.log('Stored storeId:',userResponse.data.store.id);console.log('Stored userId:',userResponse.data.id);// Navigate with replace\nnavigate('/pos',{replace:true});}catch(error){var _error$response,_error$response$data,_error$response$data$;console.error('Login error:',error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:(_error$response$data$=_error$response$data.error)===null||_error$response$data$===void 0?void 0:_error$response$data$.message)||'Login failed. Please try again.');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(Box,{sx:{height:'100vh',display:'flex',alignItems:'center',justifyContent:'center',bgcolor:'background.default'},children:/*#__PURE__*/_jsx(Card,{sx:{maxWidth:400,width:'90%',boxShadow:3},children:/*#__PURE__*/_jsxs(CardContent,{sx:{p:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",component:\"h1\",gutterBottom:true,align:\"center\",children:\"Login to POS System\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Username\",variant:\"outlined\",margin:\"normal\",value:identifier,onChange:e=>setIdentifier(e.target.value),disabled:loading}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Password\",type:\"password\",variant:\"outlined\",margin:\"normal\",value:password,onChange:e=>setPassword(e.target.value),disabled:loading}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:2},children:error}),/*#__PURE__*/_jsx(Button,{type:\"submit\",fullWidth:true,variant:\"contained\",size:\"large\",sx:{mt:3},disabled:loading,children:loading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Login'})]})]})})});}export default Login;","map":{"version":3,"names":["React","useState","useNavigate","API","Box","Card","CardContent","TextField","Button","Typography","Alert","CircularProgress","jsx","_jsx","jsxs","_jsxs","Login","identifier","setIdentifier","password","setPassword","error","setError","loading","setLoading","navigate","handleLogin","e","preventDefault","_userResponse$data$st","loginResponse","post","jwt","data","Error","localStorage","setItem","userResponse","get","console","log","store","id","replace","_error$response","_error$response$data","_error$response$data$","response","message","sx","height","display","alignItems","justifyContent","bgcolor","children","maxWidth","width","boxShadow","p","variant","component","gutterBottom","align","onSubmit","fullWidth","label","margin","value","onChange","target","disabled","type","severity","mt","size"],"sources":["/Users/oan/Desktop/POS/pos-frontend/src/components/Login.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport API from '../services/api';  // Import our API service\nimport {\n  Box,\n  Card,\n  CardContent,\n  TextField,\n  Button,\n  Typography,\n  Alert,\n  CircularProgress\n} from '@mui/material';\n\nfunction Login() {\n  const [identifier, setIdentifier] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // Use API service instead of axios directly\n      const loginResponse = await API.post('/api/auth/local', {\n        identifier,\n        password,\n      });\n      \n      const jwt = loginResponse.data.jwt;\n      if (!jwt) {\n        throw new Error('No JWT received');\n      }\n      \n      localStorage.setItem('jwtToken', jwt);\n      \n      // Use API service for user data\n      const userResponse = await API.get('/api/users/me?populate=store');\n      console.log('User data:', userResponse.data);\n      \n      if (!userResponse.data.store?.id) {\n        throw new Error('User has no assigned store');\n      }\n\n      // Save store ID and user ID\n      localStorage.setItem('storeId', userResponse.data.store.id);\n      localStorage.setItem('userId', userResponse.data.id);\n      console.log('Stored storeId:', userResponse.data.store.id);\n      console.log('Stored userId:', userResponse.data.id);\n\n      // Navigate with replace\n      navigate('/pos', { replace: true });\n\n    } catch (error) {\n      console.error('Login error:', error);\n      setError(error.response?.data?.error?.message || 'Login failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Box\n      sx={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        bgcolor: 'background.default'\n      }}\n    >\n      <Card sx={{ maxWidth: 400, width: '90%', boxShadow: 3 }}>\n        <CardContent sx={{ p: 4 }}>\n          <Typography variant=\"h5\" component=\"h1\" gutterBottom align=\"center\">\n            Login to POS System\n          </Typography>\n          \n          <form onSubmit={handleLogin}>\n            <TextField\n              fullWidth\n              label=\"Username\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={identifier}\n              onChange={(e) => setIdentifier(e.target.value)}\n              disabled={loading}\n            />\n            \n            <TextField\n              fullWidth\n              label=\"Password\"\n              type=\"password\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              disabled={loading}\n            />\n            \n            {error && (\n              <Alert severity=\"error\" sx={{ mt: 2 }}>\n                {error}\n              </Alert>\n            )}\n            \n            <Button\n              type=\"submit\"\n              fullWidth\n              variant=\"contained\"\n              size=\"large\"\n              sx={{ mt: 3 }}\n              disabled={loading}\n            >\n              {loading ? <CircularProgress size={24} /> : 'Login'}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n\nexport default Login; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}