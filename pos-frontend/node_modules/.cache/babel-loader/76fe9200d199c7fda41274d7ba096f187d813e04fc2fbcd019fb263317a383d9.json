{"ast":null,"code":"import React,{useState}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{Box,Card,CardContent,TextField,Button,Typography,Alert,CircularProgress}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){const[identifier,setIdentifier]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleLogin=async e=>{e.preventDefault();setLoading(true);setError('');try{var _userResponse$data$st;// First API call - login\nconst loginResponse=await axios.post(`${process.env.REACT_APP_API_URL||'http://localhost:1337'}/api/auth/local`,{identifier,password});const jwt=loginResponse.data.jwt;if(!jwt){throw new Error('No JWT received');}localStorage.setItem('jwtToken',jwt);// Second API call - get user data with store info\nconst userResponse=await axios.get(`${process.env.REACT_APP_API_URL||'http://localhost:1337'}/api/users/me?populate=store`,{headers:{Authorization:`Bearer ${jwt}`}});console.log('User data:',userResponse.data);if(!((_userResponse$data$st=userResponse.data.store)!==null&&_userResponse$data$st!==void 0&&_userResponse$data$st.id)){throw new Error('User has no assigned store');}// Save store ID\nlocalStorage.setItem('storeId',userResponse.data.store.id);console.log('Stored storeId:',userResponse.data.store.id);navigate('/pos');}catch(error){var _error$response,_error$response$data,_error$response$data$;console.error('Login error:',error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:(_error$response$data$=_error$response$data.error)===null||_error$response$data$===void 0?void 0:_error$response$data$.message)||'Login failed. Please try again.');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(Box,{sx:{height:'100vh',display:'flex',alignItems:'center',justifyContent:'center',bgcolor:'background.default'},children:/*#__PURE__*/_jsx(Card,{sx:{maxWidth:400,width:'90%',boxShadow:3},children:/*#__PURE__*/_jsxs(CardContent,{sx:{p:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",component:\"h1\",gutterBottom:true,align:\"center\",children:\"Login to POS System\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Username\",variant:\"outlined\",margin:\"normal\",value:identifier,onChange:e=>setIdentifier(e.target.value),disabled:loading}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Password\",type:\"password\",variant:\"outlined\",margin:\"normal\",value:password,onChange:e=>setPassword(e.target.value),disabled:loading}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:2},children:error}),/*#__PURE__*/_jsx(Button,{type:\"submit\",fullWidth:true,variant:\"contained\",size:\"large\",sx:{mt:3},disabled:loading,children:loading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Login'})]})]})})});}export default Login;","map":{"version":3,"names":["React","useState","axios","useNavigate","Box","Card","CardContent","TextField","Button","Typography","Alert","CircularProgress","jsx","_jsx","jsxs","_jsxs","Login","identifier","setIdentifier","password","setPassword","error","setError","loading","setLoading","navigate","handleLogin","e","preventDefault","_userResponse$data$st","loginResponse","post","process","env","REACT_APP_API_URL","jwt","data","Error","localStorage","setItem","userResponse","get","headers","Authorization","console","log","store","id","_error$response","_error$response$data","_error$response$data$","response","message","sx","height","display","alignItems","justifyContent","bgcolor","children","maxWidth","width","boxShadow","p","variant","component","gutterBottom","align","onSubmit","fullWidth","label","margin","value","onChange","target","disabled","type","severity","mt","size"],"sources":["/Users/oan/Desktop/POS/pos-frontend/src/components/Login.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  Box,\n  Card,\n  CardContent,\n  TextField,\n  Button,\n  Typography,\n  Alert,\n  CircularProgress\n} from '@mui/material';\n\nfunction Login() {\n  const [identifier, setIdentifier] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // First API call - login\n      const loginResponse = await axios.post(\n        `${process.env.REACT_APP_API_URL || 'http://localhost:1337'}/api/auth/local`,\n        {\n          identifier,\n          password,\n        }\n      );\n      \n      const jwt = loginResponse.data.jwt;\n      if (!jwt) {\n        throw new Error('No JWT received');\n      }\n      \n      localStorage.setItem('jwtToken', jwt);\n      \n      // Second API call - get user data with store info\n      const userResponse = await axios.get(\n        `${process.env.REACT_APP_API_URL || 'http://localhost:1337'}/api/users/me?populate=store`,\n        {\n          headers: {\n            Authorization: `Bearer ${jwt}`\n          }\n        }\n      );\n      \n      console.log('User data:', userResponse.data);\n      \n      if (!userResponse.data.store?.id) {\n        throw new Error('User has no assigned store');\n      }\n\n      // Save store ID\n      localStorage.setItem('storeId', userResponse.data.store.id);\n      console.log('Stored storeId:', userResponse.data.store.id);\n\n      navigate('/pos');\n\n    } catch (error) {\n      console.error('Login error:', error);\n      setError(error.response?.data?.error?.message || 'Login failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Box\n      sx={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        bgcolor: 'background.default'\n      }}\n    >\n      <Card sx={{ maxWidth: 400, width: '90%', boxShadow: 3 }}>\n        <CardContent sx={{ p: 4 }}>\n          <Typography variant=\"h5\" component=\"h1\" gutterBottom align=\"center\">\n            Login to POS System\n          </Typography>\n          \n          <form onSubmit={handleLogin}>\n            <TextField\n              fullWidth\n              label=\"Username\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={identifier}\n              onChange={(e) => setIdentifier(e.target.value)}\n              disabled={loading}\n            />\n            \n            <TextField\n              fullWidth\n              label=\"Password\"\n              type=\"password\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              disabled={loading}\n            />\n            \n            {error && (\n              <Alert severity=\"error\" sx={{ mt: 2 }}>\n                {error}\n              </Alert>\n            )}\n            \n            <Button\n              type=\"submit\"\n              fullWidth\n              variant=\"contained\"\n              size=\"large\"\n              sx={{ mt: 3 }}\n              disabled={loading}\n            >\n              {loading ? <CircularProgress size={24} /> : 'Login'}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n\nexport default Login; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}