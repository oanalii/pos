{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import API from'../services/api';// Import our API service\nimport{Box,Card,CardContent,TextField,Button,Typography,Alert,CircularProgress}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){const[identifier,setIdentifier]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleLogin=async e=>{e.preventDefault();setLoading(true);setError('');try{const response=await API.post('/api/auth/local',{identifier:identifier,password:password});// Make sure this is being set\nlocalStorage.setItem('jwtToken',response.data.jwt);// Configure API for future requests\nAPI.defaults.headers.common['Authorization']=`Bearer ${response.data.jwt}`;// Get user data with store info\nconst userResponse=await API.get('/api/users/me?populate=*',{headers:{Authorization:`Bearer ${response.data.jwt}`}});const userData=userResponse.data;// Store user and store IDs\nlocalStorage.setItem('userId',userData.id);if(userData.store){localStorage.setItem('storeId',userData.store.id);navigate('/pos');// Navigate to POS if store exists\n}else{setError('User is not associated with a store');localStorage.clear();return;}}catch(error){var _error$response,_error$response$data,_error$response$data$;console.error('Login error:',error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:(_error$response$data$=_error$response$data.error)===null||_error$response$data$===void 0?void 0:_error$response$data$.message)||'Login failed. Please try again.');localStorage.clear();}finally{setLoading(false);}};return/*#__PURE__*/_jsx(Box,{sx:{height:'100vh',display:'flex',alignItems:'center',justifyContent:'center',bgcolor:'background.default'},children:/*#__PURE__*/_jsx(Card,{sx:{maxWidth:400,width:'90%',boxShadow:3},children:/*#__PURE__*/_jsxs(CardContent,{sx:{p:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",component:\"h1\",gutterBottom:true,align:\"center\",children:\"Login to POS System\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Username\",variant:\"outlined\",margin:\"normal\",value:identifier,onChange:e=>setIdentifier(e.target.value),disabled:loading}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Password\",type:\"password\",variant:\"outlined\",margin:\"normal\",value:password,onChange:e=>setPassword(e.target.value),disabled:loading}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:2},children:error}),/*#__PURE__*/_jsx(Button,{type:\"submit\",fullWidth:true,variant:\"contained\",size:\"large\",sx:{mt:3},disabled:loading,children:loading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Login'})]})]})})});}export default Login;","map":{"version":3,"names":["React","useState","useNavigate","API","Box","Card","CardContent","TextField","Button","Typography","Alert","CircularProgress","jsx","_jsx","jsxs","_jsxs","Login","identifier","setIdentifier","password","setPassword","error","setError","loading","setLoading","navigate","handleLogin","e","preventDefault","response","post","localStorage","setItem","data","jwt","defaults","headers","common","userResponse","get","Authorization","userData","id","store","clear","_error$response","_error$response$data","_error$response$data$","console","message","sx","height","display","alignItems","justifyContent","bgcolor","children","maxWidth","width","boxShadow","p","variant","component","gutterBottom","align","onSubmit","fullWidth","label","margin","value","onChange","target","disabled","type","severity","mt","size"],"sources":["/Users/oan/Desktop/POS/pos-frontend/src/components/Login.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport API from '../services/api';  // Import our API service\nimport {\n  Box,\n  Card,\n  CardContent,\n  TextField,\n  Button,\n  Typography,\n  Alert,\n  CircularProgress\n} from '@mui/material';\n\nfunction Login() {\n  const [identifier, setIdentifier] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      const response = await API.post('/api/auth/local', {\n        identifier: identifier,\n        password: password\n      });\n\n      // Make sure this is being set\n      localStorage.setItem('jwtToken', response.data.jwt);\n      \n      // Configure API for future requests\n      API.defaults.headers.common['Authorization'] = `Bearer ${response.data.jwt}`;\n      \n      // Get user data with store info\n      const userResponse = await API.get('/api/users/me?populate=*', {\n        headers: {\n          Authorization: `Bearer ${response.data.jwt}`\n        }\n      });\n      \n      const userData = userResponse.data;\n      \n      // Store user and store IDs\n      localStorage.setItem('userId', userData.id);\n      if (userData.store) {\n        localStorage.setItem('storeId', userData.store.id);\n        navigate('/pos');  // Navigate to POS if store exists\n      } else {\n        setError('User is not associated with a store');\n        localStorage.clear();\n        return;\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      setError(error.response?.data?.error?.message || 'Login failed. Please try again.');\n      localStorage.clear();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Box\n      sx={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        bgcolor: 'background.default'\n      }}\n    >\n      <Card sx={{ maxWidth: 400, width: '90%', boxShadow: 3 }}>\n        <CardContent sx={{ p: 4 }}>\n          <Typography variant=\"h5\" component=\"h1\" gutterBottom align=\"center\">\n            Login to POS System\n          </Typography>\n          \n          <form onSubmit={handleLogin}>\n            <TextField\n              fullWidth\n              label=\"Username\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={identifier}\n              onChange={(e) => setIdentifier(e.target.value)}\n              disabled={loading}\n            />\n            \n            <TextField\n              fullWidth\n              label=\"Password\"\n              type=\"password\"\n              variant=\"outlined\"\n              margin=\"normal\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              disabled={loading}\n            />\n            \n            {error && (\n              <Alert severity=\"error\" sx={{ mt: 2 }}>\n                {error}\n              </Alert>\n            )}\n            \n            <Button\n              type=\"submit\"\n              fullWidth\n              variant=\"contained\"\n              size=\"large\"\n              sx={{ mt: 3 }}\n              disabled={loading}\n            >\n              {loading ? <CircularProgress size={24} /> : 'Login'}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n\nexport default Login; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}